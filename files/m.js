(function(g,Y,ra,Z,xa){function ja(f,c,g,F){function J(){B.hide();$(Y).off("click",J)}function C(c){K.val(c);f.css("background",c);J();F(c)}function z(c){return function(){C(g[c])}}f.addClass("picker");for(var B=$("<div/>",{"class":"pickpop"}),p=$("<div/>",{"class":"colorPanel"}),K=$("<input/>",{"class":"color-input",type:"text",value:g[c],maxlength:7,tabindex:-1}),h,u=0;u<g.length;u++)h=$("<div/>",{"class":"colorBox",css:{background:g[u]}}),h.click(z(u)),p.append(h);K.change(function(){C(K.val())});
B.click(cancelEvent).html(p.append(K));f.css("background-color",g[c]).click(function(c){cancelEvent(c);"none"===B.css("display")?(B.show(),Z.click(J)):J()}).html(B)}function V(f,c,g,F){c=c?1:"";var J=$(".gen-anon").prop("checked")&&!c?1:"",C=$(".gen-private").prop("checked")&&!c?1:"";if(mm.useCanvas){var z=mm.currentMeme(),B=mm.ctx(),p=mm.canv(),K=mm.getText();signCanvas(B,p.width,p.height,67600);B=p.toDataURL("image/jpeg");g&&aa(B,!0);for(var p=mm.memeData(),h,u=0;u<p.boxes.length;u++)if(h=p.boxes[u],
"image"===h.type&&.5<h.w/z.w&&.5<h.h/z.h){p.template=0;break}$.extend(p,{imgData:B.substr(B.search(",")+1),meme:z.name,text:K,type:"jpeg",anon:J,"private":C,isReply:c,stream_name:F});$.ajax({url:"/ajax_meme_done_canvas",type:"post",data:p,dataType:"json",success:function(c){"s3"===c.error?f(c,!0):c.error?(loading(!1),error_dialog(c.error)):f(c,C);_gaq.push(["_trackEvent","memedoneCanvas "+(c.error?"Failure":"Success"),z.id+" - "+z.name,I.user.user||"anon"])}})}else c=$.extend(mm.memeData(),{anon:J,
"private":C,isReply:c,stream_name:F}),loading("Generating Meme..."),$.ajax({url:"/ajax_meme_done",type:"post",data:c,dataType:"json",success:function(c){loading(!1);c.error?error_dialog(c.error):(g&&aa(),f(c,C));_gaq.push(["_trackEvent","memedoneAjax "+(c.error?"Failure":"Success"),"derp",I.user.user||"anon"])}})}function sa(f,c){ca(f,c,"meme",function(){mm.reset();imgDoneBox.hide()},mm.currentMeme().name||"Untitled")}function da(){ea||(ea=!0,$.getScript("//s.po.st/static/v3/post-widget.js"))}function aa(f,
c){da();g.scrollTo(0,0);g.imgDoneBox=new Box({html:'<div id="done"><img id="doneImage"'+(f?' src="'+f+'"':"")+'/><div><div id="doneShare"></div><div id="doneUrl">'+(c?'<img src="//s.imgflip.com/preloader.gif"/>':"")+'</div></div><div id="doneLinks"></div></div>',bg:"transparent",top:20,hideX:!0,noMaskClick:!0})}function ca(f,c,R,F,J){_gaq.push("_trackPageview");var C={meme:"jpg",gif:"gif",pie:"png",demotivational:"jpg"}[R],z=parseInt(f.iid).toString(36),B=("gif"===C?"/gif/":"/i/")+z,p=!0,K=$("#doneImage"),
h=$("#doneUrl");if(!K.attr("src"))K.attr("src",(c?"//i2.imgflip.com/":IMAGE_DOMAIN)+z+"."+C);else if(!c){var u=new Image;$(u).load(function(){K.attr("src",$(this).attr("src"))});u.src=IMAGE_DOMAIN+z+"."+C}Z.on("contextmenu","#doneImage",function(){p=!1});h.html(embedCodes(z,C,c,!c&&"gif"!==R,R)).find(".img-code").click(function(){$(this).select();p=!1}).on("focus",function(){p=!1});c||I.user.id?!c&&0<I.user.subsLeft&&(h.append('<div class="done-msg">You have '+I.user.subsLeft+" remaining submission"+
(1!=I.user.subsLeft?"s":"")+' today. <span id="done-submit" class="done-link a">Submit this image</span></div>'),$("#done-submit").click(function(){p=!1;submitImg(f.iid)})):(u='<div class="done-msg">You are not logged in! If you want to claim or delete this image, ',u+='<a class="done-link" target="_blank" href="/login?claim_iid='+f.iid+'">Login and claim it</a>',u+=' or <a class="done-link" target="_blank" href="/signup?claim_iid='+f.iid+'">Signup and claim it</a>',u+="</div>",h.append(u));u=$('<div class="l but">&larr; Change settings</div>').click(function(){p&&
!g.doneshare&&$.get("/ajax_delete_creation?iid="+f.iid);g.doneshare=!1;imgDoneBox.hide()});h=$('<div class="l but">Make another</div>').click(F);F=$("#doneLinks");F.html(u);c?(J="This image is private. It will only be stored on imgflip servers long enough for you to download it.","s3"===f.error&&(J='<span style="color:red">Whoops! Temporary error while uploading to clouds. You can download your image directly, or reload and try again.</span>'),$("#doneShare").html(J)):(B=$("<a class='l but' href='"+
B+"'>Go to image page</a>"),B.click(function(){p=!1}),F.append(B),insertShares("#doneShare",z,C,J));F.append(h);g.disable_zaz||c||"gif"===C||(c="http://www.zazzle.com/api/create/at-238106848995316905?rf=238106848995316905&ax=DesignBlast&sr=250237863432431386&t__useQpc=true&ed=true&t__smart=true&continueUrl="+encodeURI("https://imgflip.com/i/"+z)+"&fwd=ProductPage&coverimage="+encodeURI("https://i.imgflip.com/"+z+"."+C),c=$('<div class="done-msg"><a class="done-zazzle-link" target="_blank" href="'+
c+'">Put this meme on a T-shirt/hat/mug/etc. on Zazzle!</a></div>'),c.find(".done-zazzle-link").click(function(){p=!1;_gaq.push(["_trackEvent","zazzle click",g.mm?g.mm.currentMeme().name:R,I.user.id?"logged-in":"logged-out"])}),F.after(c))}var ya=g.File&&g.FileReader&&g.FileList;MemeMaker=function(f,c){function R(a){return 0===a.id?H?H.src:"":a.url_name?"/s/meme/"+a.url_name+".jpg":"https://i.imgflip.com/"+a.id.toString(36)+".jpg?a"+Math.round(+new Date/1E3/3600)+("imgflip.com"!==g.location.hostname?
"&j":"")}function F(a,b){return Math.min(a,Math.max(500,a/b*500))}function J(){var a=x();a.w+=a.h;a.h=a.w-a.h;a.w-=a.h;a.rotation=270===a.rotation?0:~~a.rotation+90;k.select(fa)}function C(a){a?O.removeClass("no-events").find(".cropBox").removeClass("off"):O.addClass("no-events").find(".cropBox").addClass("off");A.find(".mm-toggle-drag").prop("checked",a)}function z(){var a=$("#mm-upload"),b=$("#mm-show-upload");"none"===a.css("display")?(z.oldText=b.text(),a.slideDown(200),b.text("Hide upload frame")):
(a.slideUp(200),b.text(z.oldText))}function B(){if(ya){var a=$("#mm-upload-file")[0].files[0];if(-1===a.type.search(/^image/))MSG("File is not an image","red");else{var b=new FileReader;b.onload=function(a){H=new Image;$(H).load(function(a){f.custom={id:0,name:"Custom Image",w:H.width,h:H.height};k.select("custom")});H.src=a.target.result};b.readAsDataURL(a);z()}}else alert("To use a fully private template, your browser needs to support the HTML5 File API. All modern browsers support the File API. If you cannot upgrade your browser right away, you can still create your meme if you set the template as public.")}
function p(a,b,c){function e(){f.updateColors()}var E='<div class="text-wrap"><textarea placeholder="'+("top"==a?"TOP TEXT":"bottom"==a?"BOTTOM TEXT":"MORE TEXT")+'" class="mm-text"></textarea><div class="fontOps"><div class="picker mm-font-color-picker" title="Change Font Color"></div>';ka||(E+='<div class="picker mm-outline-color-picker" title="Change Outline Color"></div><input class="ow" type="number" maxlength="1" min="0" max="9" title="Change Outline Width" tabindex="-1"/>');E=$(E+"</div></div>");
A.find(".mm-text-boxes").append(E);var f=new u(E,a,b);d.push(f);c&&f.autoResize(x().w,x().h,!0);ja(E.find(".mm-font-color-picker"),1,la,e);ka||ja(E.find(".mm-outline-color-picker"),0,la,e);2<d.length&&K(f.$box);za&&za(E)}function K(a){a.css({background:"#fff"}).animate({opacity:0},500,function(){$(this).css({background:"none",opacity:1})})}function h(){if(ga){P.naturalWidth?0<x().rotation?(m.translate(r.width/2,r.height/2),m.rotate(x().rotation/180*Math.PI),180===x().rotation?(m.translate(-r.width/
2,-r.height/2),m.drawImage(P,0,0,r.width,r.height),m.translate(r.width/2,r.height/2)):(m.translate(-r.height/2,-r.width/2),m.drawImage(P,0,0,r.height,r.width),m.translate(r.height/2,r.width/2)),m.rotate(-x().rotation/180*Math.PI),m.translate(-r.width/2,-r.height/2)):m.drawImage(P,0,0,r.width,r.height):m.clearRect(0,0,r.width,r.height);Aa&&Aa(m,r);m.shadowBlur=0;L&&m.drawImage(L,0,0);for(var a=0;a<d.length;a++)"image"!==d[a].type||d[a].hidden||d[a].draw();for(a=0;a<d.length;a++)"text"!==d[a].type||
d[a].hidden||d[a].draw()}else for(a=0;a<d.length;a++)d[a].hidden||d[a].draw()}function u(a,b,c){if(ga)return new Z(a,b,c);c=c||{};var e=this,E;e.type="text";e.align=b;e.size=c.maxFontSize||A.find(".mm-size").val()>>0||Ba;e.outline_width=2;e.text="";e.font_color="#ffffff";e.outline_color="#000000";e.font=(A.find(".mm-font").val()||"impact")+",impac";e.$text_wrap=a;var d=e.$box=$("<div/>",{"class":"box cropBox off"}),f=a.find(".mm-text");d.hover(function(){clearTimeout(Q);$(".cropBox").removeClass("off")},
function(){Q=setTimeout(function(){$(".cropBox").addClass("off")},10)});A.find(".mm-font").change(function(){k($(this).val())});A.find(".mm-size").change(function(){e.size=E=$(this).val()>>0;e.draw()}).keyup(function(){e.size=E=$(this).val()>>0;e.draw()});a.find(".ow").change(function(){e.outline_width=$(this).val()>>0;4<e.outline_width&&(e.outline_width=4);e.draw()}).keyup(function(){e.outline_width=$(this).val()>>0;4<e.outline_width&&(e.outline_width=4);e.draw()}).val(e.outline_width);b=e.setText=
function(){e.text=ba?f.val().toUpperCase():f.val();e.draw()};var k=e.setFont=function(a){e.font=(a||"impact")+",impac";e.draw()};e.getFont=function(){return e.font.split(",")[0]};e.updateColors=function(){e.font_color=a.find(".mm-font-color-picker .color-input").val();e.outline_color=a.find(".mm-outline-color-picker .color-input").val();e.draw()};e.getVals=function(){var a=g.getVals();return[a.x/n>>0,a.y/n>>0,a.w/n>>0,a.h/n>>0,E/1.32/n>>0]};e.setVals=function(a,e,b,c){g.setVals(a*n>>0,e*n>>0,b*n>>
0,c*n>>0)};e.setAlign=function(a){e.align=a};e.autoResize=function(a,b){var c=a*n-10,d=b*n/4,E=5;"bottom"===e.align?E=3*d-15:"middle"===e.align&&(E=1.5*d-2);g.setVals(5,E,c,d)};e.draw=function(){var a=g.getVals(),b=e.text,c=b.length,f=2+c/30>>0,t=b.split(" ").length,k=Math.sqrt(c*a.h/a.w/2.8)+.5>>0;k||(k=1);k>t&&(k=t);for(var m=c/k,M=[],t=[],w=-1;w<=k;w++)t[w]={};var q=0,q=0,h=(1.32*e.size>>0)+2;-6>E-h&&(h=E+6);var v,w=$("#testline");do{h-=2;v=1.21*h/1.32>>0;for(var y=0;y<=k;y++)y==k?M[y]=c:(q=(m*
y>>0)-f,0>q&&(q=0),q=y?b.indexOf(" ",q):0,M[y]=-1==q?c:q),y&&(t[y-1].text=b.substr(M[y-1],M[y]-M[y-1]));for(var q=4+.1*h/1.32,n=0,p=q*(k-1),y=0;y<k;y++)w.css({font:"400 "+h+"px/"+v+"px "+e.font,height:v}).text(t[y].text),t[y].w=w.width(),t[y].h=v,t[y].w>n&&(n=t[y].w),p+=v}while(!(n<=a.w&&p<=a.h));E=h;w=a.h-p;"top"===e.align&&(w=0);"middle"===e.align&&(w/=2);t[-1].h=0;for(var m=w,y="",Ca,ma=e.outline_width,w=0;w<k;w++)for(b=t[w].w,c=t[w].h,f=(a.w-b)/2,m=m+t[w-1].h+(w?q:0),M=t[w].text,n=f-ma;n<=f+ma;n++)for(p=
m-ma;p<=m+ma;p++)Ca=n==f&&p==m?"z-index:2;color:"+e.font_color+";":"color:"+e.outline_color+";",y+="<div class='line' style='font:400 "+h+"px/"+v+"px "+e.font+";"+Ca+"top:"+p+"px;left:"+n+"px;width:"+b+"px;height:"+c+"px;'>"+M+"</div>";d.find(".line").remove();d.append(y)};var g=new Dragger(d,O,e.draw);f.change(b).keyup(b);na.after(d)}function Z(a,b,c){c=c||{};var e=this,d,f=!ka&&A.find(".mm-use-shadow").prop("checked");e.type="text";e.align=b;e.size=c.maxFontSize||A.find(".mm-size").val()>>0||Ba;
e.outline_width=f?5:1;e.text="";e.font_color="#ffffff";e.outline_color="#000000";e.font=(A.find(".mm-font").val()||"impact")+",impac";e.$text_wrap=a;b=e.$box=$("<div/>",{"class":"box cropBox off"});var k=new Dragger(b,O,h),g=a.find(".mm-text");b.hover(function(){clearTimeout(Q);$(".cropBox").removeClass("off")},function(){Q=setTimeout(function(){$(".cropBox").addClass("off")},10)}).on("vmousedown",function(){$(".cropBox").removeClass("off")});A.find(".mm-font").change(function(){l($(this).val())}).end().find(".mm-size").change(function(){e.size=
d=$(this).val()>>0;h()}).keyup(function(){e.size=d=$(this).val()>>0;h()}).end().find(".mm-use-shadow").change(function(){f=!!$(this).prop("checked");a.find(".ow").val(e.outline_width=f?5:1);h()});a.find(".ow").change(function(){e.outline_width=$(this).val()>>0;h()}).keyup(function(){e.outline_width=$(this).val()>>0;h()}).val(e.outline_width);var p=e.setText=function(){e.text=ba?g.val().toUpperCase():g.val();h()},l=e.setFont=function(a){e.font=(a||"impact")+",impac";h()};e.getFont=function(){return e.font.split(",")[0]};
e.updateColors=function(){e.font_color=a.find(".mm-font-color-picker .color-input").val();e.outline_color=a.find(".mm-outline-color-picker .color-input").val();h()};e.getVals=function(){var a=k.getVals();return[a.x/n>>0,a.y/n>>0,a.w/n>>0,a.h/n>>0,d/1.32/n>>0]};e.setVals=function(a,e,b,c){k.setVals(a*n>>0,e*n>>0,b*n>>0,c*n>>0)};e.setAlign=function(a){e.align=a};e.autoResize=function(a,b,c){var d;if(c)a=a*n-10,d=b*n/4,c=b=5,"bottom"===e.align?c=3*d-13:"middle"===e.align&&(c=1.5*d-2);else{d=D/oa;var f=
k.getVals();b=d*f.x;c=d*f.y;a=d*f.w;d*=f.h}k.setVals(b,c,a,d)};e.draw=function(){var a=k.getVals(),b=G/D,a={x:Math.round(b*a.x),y:Math.round(b*a.y),w:Math.round(b*a.w),h:Math.round(b*a.h)};m.shadowBlur=f?e.outline_width:0;m.shadowColor=f?e.outline_color:"";var c=e.text,t=c.length,g=2+t/30>>0,h=c.split(" ").length;(b=Math.sqrt(t*a.h/a.w/2.8)+.5>>0)||(b=1);b>h&&(b=h);for(var M=t/b,w=[],h=[],q=-1;q<=b;q++)h[q]={};var l=0,l=0,q=e.size+2;-6>d-q&&(q=d+6);do{q-=2;m.font=q+"px "+e.font;for(var v=0;v<=b;v++)v==
b?w[v]=t:(l=(M*v>>0)-g,0>l&&(l=0),l=v?c.indexOf(" ",l):0,w[v]=-1==l?t:l),v&&(h[v-1].text=c.substr(w[v-1],w[v]-w[v-1]));for(var l=4+.1*q,p=0,n=l*(b-1),v=0;v<b;v++)h[v].w=m.measureText(h[v].text).width,h[v].h=.85*q,h[v].w>p&&(p=h[v].w),n+=.85*q}while(p>a.w||n>a.h);d=q;c=a.h-n;"top"===e.align&&(c=0);"middle"===e.align&&(c/=2);h[-1].h=0;t=c;for(q=0;q<b;q++)if(c=(a.w-h[q].w)/2,t+=h[q].h,q&&(t+=l),g=h[q].text,m.fillStyle=e.font_color,f)for(M=0;6>M;M++)m.fillText(g,a.x+c,a.y+t);else m.strokeStyle=e.outline_color,
m.lineWidth=e.outline_width,m.fillText(g,a.x+c,a.y+t),ka||m.strokeText(g,a.x+c,a.y+t)};g.change(p).keyup(p);S.after(b);c.coords&&(c=c.coords,k.setVals(c[0],c[1],c[2],c[3]))}function V(a){this.type="image";this.element=a;var b=this.$box=$("<div/>",{"class":"box cropBox off"}),c=new Dragger(b,O,h);b.hover(function(){clearTimeout(Q);$(".cropBox").removeClass("off")},function(){Q=setTimeout(function(){$(".cropBox").addClass("off")},10)});this.getVals=function(){var a=c.getVals();return[a.x/n>>0,a.y/n>>
0,a.w/n>>0,a.h/n>>0]};this.autoResize=function(e,b,d){var f;if(d)e=b=Math.min(e*n/3>>0,b*n/3>>0),a.width>a.height?(d=e,f=a.height/a.width*d):(f=e,d=a.width/a.height*f);else{f=D/oa;var k=c.getVals();e=f*k.x;b=f*k.y;d=f*k.w;f*=k.h}c.setVals(e,b,d,f)};this.draw=function(){var b=c.getVals(),d=G/D,b={x:Math.round(d*b.x),y:Math.round(d*b.y),w:Math.round(d*b.w),h:Math.round(d*b.h)};m.drawImage(a,~~b.x,~~b.y,~~b.w,~~b.h)};S.after(b);this.autoResize(x().w,x().h,!0);c.lockRatio()}function aa(){var a=T.find(".draw");
a.hasClass("set")?(a.removeClass("set"),a.text("Draw"),T.find(".mm-add-img, .add-scumbag, .mm-rotate").show(),T.find(".picker,.erase").hide(),$(".box").show(),S.off("mousedown",ca).off("mousemove",da),$(Y).off("mouseup",ea)):(a.addClass("set"),a.text("Stop Drawing"),T.find(".mm-add-img, .add-scumbag, .mm-rotate").hide(),T.find(".picker,.erase").show(),$(".box").hide(),S.mousedown(ca).mousemove(da),$(Y).mouseup(ea))}function ca(a){a.preventDefault();var b=a.clientX-$(this).offset().left+$(g).scrollLeft();
a=a.clientY-$(this).offset().top+$(g).scrollTop();var c=G/D,b=Math.round(c*b);a=Math.round(c*a);U.beginPath();m.beginPath();U.moveTo(b,a);m.moveTo(b,a);m.save();m.shadowBlur=0;m.strokeStyle=pa;U.strokeStyle=pa;$("body").addClass("nosel");ha=!0}function da(a){if(ha){var b=a.clientX-$(this).offset().left+$(g).scrollLeft();a=a.clientY-$(this).offset().top+$(g).scrollTop();var c=G/D,b=Math.round(c*b);a=Math.round(c*a);U.lineTo(b,a);U.stroke();m.lineTo(b,a);m.stroke()}}function ea(){ha&&(m.restore(),ha=
0,$("body").removeClass("nosel"),W=!0)}function ia(){$("#mygen").hide();$("#memewrap").show();$(".mm-tab").removeClass("set");$("#memetab").addClass("set");if(!$("#memewrap").html()){var a=0,b="",c=0,e,d="//s.imgflip.com/ms"+spriteNum+".jpg",k;for(k in f)f.hasOwnProperty(k)&&!isNaN(k)&&(a++,e='style="background:url('+d+") "+-50*c+'px 0px;"',c++,b+='<div class="im" '+e+" onclick=\"mm.changeMeme('"+k+'\')" alt="'+f[k].name+' Meme Image" title="Make '+f[k].name+' Meme"></div>');$("#memewrap").append(b+
'<a class="y but" id="allTemplates" href="/memetemplates">View All Meme Templates</a>')}Da()}function ta(){$("#memewrap").hide();$("#mygen").show();$(".mm-tab").removeClass("set");$("#mytab").addClass("set");ta.done||(I.user.id||-1===g.location.href.search("memegenerator")?($.getJSON("/ajax_get_my_generators",function(a){if(a.error)MSG(a.error,"red");else{$.extend(f,a);a=0;var b="",c,e,d;for(d in f)c=f[d],isNaN(d)&&"U"!=d&&(e="custom"===d?H.src:IMAGE_DOMAIN+"2/"+c.id.toString(36)+".jpg",b+="<img class='im um' src='"+
e+"' onclick='mm.changeMeme(\""+d+"\")' title='"+c.name+"'/>",a++);b?$("#mygen").append(b):$("#mygen").append("<div style='line-height:50px;padding-left:10px;'>Upload an image to create your first custom generator!</div>");Da()}}),ta.done=!0):$("#mygen").append("<div style='line-height:50px;padding-left:10px;'><a rel='nofollow' href='/login?redirect=/memegenerator'>Login</a> or <a rel='nofollow' href='/signup?redirect=/memegenerator'>Signup</a> to view any custom templates you upload!"))}function Da(){$(".im").hover(function(){var a=
$("#mm-meme-title"),b=$(this).hasClass("um")?this.title:this.title.substr(5,this.title.length-10),b=b||"Untitled Template";b==x().name?a.text(b).css({"font-weight":700}):a.text(b).css({"font-weight":400})},function(){$("#mm-meme-title").text(x().name||"Untitled Template").css({"font-weight":700})})}function sa(){function a(a){var e=u.val().trim();if(!(3>e.length||!0!==a&&e===B)){var d=+new Date;F=d;B=e;a=b();var f=e+(a?"@^":"");A[f]?c(A[f]):$.ajax({url:"/ajax_meme_search",data:{q:e,include_user_memes:a?
1:0},dataType:"json",success:function(a){d===F&&(a.error?error_dialog(a.error):(A[f]=a.results,c(a.results)))}})}}function b(){return N.find(".mm-add-img-show-user-memes").prop("checked")}function c(a){var d,f;d=""+e("Featured Memes");if(a&&a.featured)for(f=0;f<a.featured.length;f++)d+=g(a.featured[f]);else d+=m();if(b())if(d+=e("User Templates"),a&&a.user)for(f=0;f<a.user.length;f++)d+=g(a.user[f]);else d+=m();if(a&&a.my)for(d+=e("My Templates"),f=0;f<a.my.length;f++)d+=g(a.my[f]);N.find(".mm-search-results").html(d)}
function e(a){return'<tr><td colspan="2" class="mm-search-section-title">'+a+"</td></tr>"}function g(a){var b;b=""+('<tr class="mm-search-result" data-id="'+a.id+'">');b=b+'<td class="mm-search-result-img-td">'+('<img class="mm-search-result-img" src="https://i.imgflip.com/2/'+(~~a.id).toString(36)+'.jpg"/>');b+="</td>";b+='<td class="mm-search-result-text">'+a.name+"</td>";return b+="</tr>"}function m(){return'<tr class="mm-search-result"><td colspan="2" class="mm-search-result-text">0 results</td></tr>'}
function n(a,b){loading("Adding Image...");N.find(".mm-add-img-type-inside").hasClass("selected")?p(a):r(a,b);z.hide()}function p(a){var b=new Image;"http"===a.substr(0,4)&&b.setAttribute("crossorigin","anonymous");$(b).load(function(){d.push(new V(b));h();loading(!1);C(!0)});b.src=a}function r(a,b){var c=R(x()),e=new Image,d=new Image;"http"===c.substr(0,4)&&e.setAttribute("crossorigin","anonymous");"http"===a.substr(0,4)&&d.setAttribute("crossorigin","anonymous");var h=!1,g=function(){if(h){var a=
Math.min(e.width,d.width),c=a/e.width*e.height,g=a/d.width*d.height,l=Y.createElement("canvas");l.width=a;l.height=c+g;var m=l.getContext("2d");m.drawImage(e,0,0,e.width,e.height,0,0,a,c);m.drawImage(d,0,0,d.width,d.height,0,c,a,g);H=new Image;$(H).load(function(){var a=x().templates||[x().id];a.push(b);f.custom={id:0,templates:a,name:"Custom Image",w:H.width,h:H.height};k.select("custom");loading(!1)});H.src=l.toDataURL("image/png")}else h=!0};$(e).load(g);$(d).load(g);e.src=c;d.src=a}var l;l='<div class="mm-add-img-popup"><div class="mm-add-img-types">';
l+='<div class="mm-add-img-type mm-add-img-type-inside selected">';l+='<div class="mm-add-img-type-title">Inside Current Image</div>';l+='<div class="mm-add-img-type-diagram"><div class="mm-add-img-current"></div><div class="mm-add-img-new"></div></div>';l+="</div>";l+='<div class="mm-add-img-type mm-add-img-type-below">';l+='<div class="mm-add-img-type-title">Below Current Image</div>';l+='<div class="mm-add-img-type-diagram"><div class="mm-add-img-current"></div><div class="mm-add-img-new"></div></div>';
l+="</div>";l+="</div>";l+='<div class="mm-add-img-choose-img">';l+='<div class="mm-add-img-upload-btn l but">Upload Image<input type="file" class="hidden-file-input"/></div>';l+='<div class="mm-add-img-or">OR</div>';l+='<input class="mm-add-img-search" type="text" placeholder="Search Memes"/>';l+='<label class="mm-add-img-show-user-memes-label"><input class="mm-add-img-show-user-memes" type="checkbox"/> Include User Templates</label>';l+='<table class="mm-search-results"></table>';l+="</div>";l+=
"</div>";var N=$(l),u=N.find(".mm-add-img-search"),z=new Box({html:N}),B="",A={},F;N.on("vclick",".mm-add-img-type",function(a){var b=$(this);b.parent().find(".mm-add-img-type").removeClass("selected");b.addClass("selected");return cancelEvent(a)});N.on("change",".mm-add-img-show-user-memes",function(){$(this).prop("checked")?confirm("This will allow any user-uploaded meme template to display in the search results, which may contain not-safe-for-work content. Are you sure you want to display user-uploaded memes?")?
a(!0):$(this).prop("checked",!1):a(!0)});N.on("keyup",".mm-add-img-search",debounce(a,300));N.on("change",".mm-add-img-search",debounce(a,300));N.on("vclick",".mm-search-result",function(a){var b=$(this).data("id");if(b)return n(R({id:b}),b),cancelEvent(a)});N.on("change",".mm-add-img-upload-btn input",function(){if(ya){var a=this.files[0];if(-1===a.type.search(/^image/))error_dialog("That file is not an image!");else{var b=new FileReader;b.onload=function(a){n(a.target.result,0)};b.readAsDataURL(a)}}else error_dialog("Your browser must have HTML5 File support to upload an image. Try upgrading to a modern browser.")})}
c=c||{};var k=this,qa=$(c.$previewOuter||"#mm-preview-outer"),O=$(c.$preview||".mm-preview"),S=O.find(".mm-canv"),na=O.find(".mm-img"),A=$(c.settingsDiv||"#mm-settings"),Ea=$("#mm-search"),G,X,D=qa.width(),oa=D,Ga=c.noDraw,ua=c.numTexts>>0,Ba=c.fontSize||50,ba=c.forceCaps!==xa?!!c.forceCaps:!0,ka=c.disableOutline,va=!1,la="#000000 #ffffff #995555 #ff3333 #ff8800 #eeee00 #22ee22 #3333ff #00bff3 #dd00cc".split(" "),wa=c.scumbagPath||"/img_util/scumbag_hat2.png",W=!1,n=1,za=c.textAdded,Aa=c.preDraw,
m,L,U,Fa,pa,P,d,Q,ha,fa,H,r=S[0],T,ga=k.useCanvas=r.getContext&&r.toDataURL&&(m=r.getContext("2d"))&&-1===navigator.userAgent.search("Android 2.");k.hideBox=function(a){d[a].hidden=!0;h()};k.showBox=function(a){d[a].hidden=!1;h()};k.setWidth=function(a){oa=D||a;D=a;n=Math.min(1,D/x().w);for(a=0;a<d.length;a++)d[a].autoResize(x().w,x().h,!1)};k.previewWidth=function(){return D};k.canvasWidth=function(){return G};k.setCanvasWidth=function(a){var b=x();G=Math.min(b.w,a);X=Math.round(b.h/b.w*G);S.attr({width:G,
height:X});L&&($(L).attr({width:G,height:X}),W=!1);k.setWidth(Math.min(G,Math.min(b.w,qa.width())))};k.setFont=function(a){for(var b=0;b<d.length;b++)"text"===d[b].type&&d[b].setFont(a)};k.ctx=function(){return m};k.canv=function(){return r};var x=k.currentMeme=function(){return f[fa]};k.text=k.getText=function(a){if(a!==xa)return d[a]?(d[a].text||"").trim():"";a="";for(var b=0;b<d.length;b++)d[b].text&&(a+=(a?" ":"")+d[b].text.trim());return a};k.boxCount=function(a){for(var b=0,c=d.length-1;0<=
c;c--)a&&d[c].type!==a||b++;return b};k.hasDrawing=function(){return W};k.isEmpty=function(){return!k.getText()&&!k.boxCount("image")&&!k.hasDrawing()};k.memeData=function(a,b){var c=0,e=[],f,k=0,g=0;a=a||1;b=b||1;for(var h=0;h<d.length;h++)f=d[h].getVals(),e.push({type:d[h].type,x:a*f[0]>>0,y:b*f[1]>>0,w:a*f[2]>>0,h:b*f[3]>>0}),"text"===d[h].type?($.extend(e[h],{color:d[h].font_color,outline_width:d[h].outline_width,outline_color:d[h].outline_color,text:ba?d[h].text.toUpperCase():d[h].text}),f[4]>
c&&(c=f[4])):"image"===d[h].type&&(k++,-1!==d[h].element.src.search(wa)&&g++);return{boxes:e,size:c*b>>0,template:100<x().id?x().id:"",templates:x().templates,font:d[0].getFont(),force_caps:ba?1:0,num_imgs:k,num_scumbag_hats:g,has_drawing:W?1:0}};k.ajaxSetPositions=function(){for(var a=[],b=0;b<d.length;b++)"text"===d[b].type&&a.push(d[b].getVals());loading("Setting Meme Positions");$.ajax({url:"/ajax_set_meme_positions",data:{meme_id:x().id,positions:a},success:function(){loading(!1)}})};k.reset=
function(){$(".mm-text").val("");$(".gen-anon, .gen-private").attr("checked",!1);for(var a=d.length-1;0<=a;a--)2>a?d[a].text="":k.removeBox(a);$("#mm-preview-outer .draw").hasClass("set")&&aa();ga&&(L.width=L.width,W=!1);h()};k.removeBox=function(a){d[a].$box.remove();d[a].$text_wrap&&d[a].$text_wrap.remove();d.splice(a,1)};k.select=function(a){fa=a;var b=f[a],c=b.w,e=b.h;va?(G=b.w,X=b.h):(G=F(b.w,b.h),X=b.h/b.w*G);oa=D;D=Math.min(G,Math.min(b.w,qa.width()));n=Math.min(1,D/b.w);$("#mm-meme-title").text(b.name||
"Untitled Template");var g;for(a=d.length-1;0<=a;a--)"text"!==d[a].type&&k.removeBox(a);var p=Math.min(2,d.length);if(b.positions){g=JSON.parse(b.positions);for(a=d.length;a<d.length+g.length-k.boxCount("text");a++)k.addText("middle");p=g.length}else 1<d.length&&(d[0].setAlign("top"),d[1].setAlign("bottom"));for(a=d.length-1;a>=p;a--)k.removeBox(a);for(a=0;a<d.length;a++)d[a].autoResize(c,e,!0),g&&g[a]&&(d[a].setAlign("middle"),d[a].setVals(g[a][0],g[a][1],g[a][2],g[a][3]));c>D&&(e=D/c*e>>0,c=D);
ga?(g=R(b),S.attr({width:G,height:X}),L&&($(L).attr({width:G,height:X}),U.lineWidth=2,U.shadowBlur=0,W=!1),m.lineWidth=2,a=$(P).attr("src"),g!==a&&($(P).load(h),g&&("http"===g.substr(0,4)?P.setAttribute("crossorigin","anonymous"):P.removeAttribute("crossorigin"),$(P).attr("src",g)))):na.css({width:c,height:e}).attr("src",0===b.id?H?H.src:"":IMAGE_DOMAIN+b.id.toString(36)+".jpg");h();$("#mm-meme-title").css({"font-weight":700})};k.changeMeme=function(a){a!=fa&&k.select(a)};k.addTextAuto=function(){p(1<
d.length?"middle":"top",{},!0);C(!0)};k.init=function(){d=[];fa=Q=ha=0;var a;if(ga){if(P=na[0],a=S,!Ga){$("#drawPanel,.draw-panel").remove();T=$('<div class="draw-panel clearfix">');var b=$('<div class="erase l but sml" title="erase all drawing">erase</div>'),c=$('<div class="draw l but sml">Draw</div>'),e=$('<div title="Change Line Color"></div>'),m=$('<div class="add-scumbag l but sml"><img alt="Add scumbag hat to meme" src="'+wa+'"/> Add Scumbag Hat</div>'),n=$('<div class="mm-add-img l but sml">Add Image</div>'),
r=$('<div class="mm-rotate l but sml" title="Rotate image"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="50px" height="50px" viewBox="0 0 50 50" enable-background="new 0 0 50 50" xml:space="preserve"><path d="M41.038,24.1l-7.152,9.342L26.734,24.1H31.4c-0.452-4.397-4.179-7.842-8.696-7.842c-4.82,0-8.742,3.922-8.742,8.742 s3.922,8.742,8.742,8.742c1.381,0,2.5,1.119,2.5,2.5s-1.119,2.5-2.5,2.5c-7.576,0-13.742-6.165-13.742-13.742 s6.166-13.742,13.742-13.742c7.274,0,13.23,5.686,13.697,12.842H41.038z"/></svg></div>');
T.append(b).append(c).append(e).append(n).append(m).append(r);L=$("<canvas/>")[0];U=L.getContext("2d");Fa=$("<img/>",{width:210,height:220,src:wa})[0];c.click(aa);b.click(function(){L.width=L.width;W=!1;h()});m.click(function(){d.push(new V(Fa));h();C(!0)});r.click(J);n.click(sa);O.before(T);pa=la[3];ja(e,3,la,function(a){pa=a})}}else a=na;1<ua&&p("top");0<ua&&p("bottom");for(b=2;b<ua;b++)p("middle");var u=$("#memewrap");Ea.keyup(function(a){for(var b=u.find(".im"),c=Ea.val(),e=c.toLowerCase(),d=
0,h,l=-1;f[d];)h=-1!==f[d].name.toLowerCase().search(e)||-1!==(f[d].altNames||"").toLowerCase().search(e),b.eq(d).css("display",h?"inline-block":"none"),h&&-1===l&&(l=d),d++;13===a.which&&(-1!==l?k.changeMeme(l):(a=GET().stream,g.location="/memesearch?q="+c+(a?"&stream="+a:"")))});a.hover(function(){clearTimeout(Q);O.find(".cropBox").removeClass("off")},function(){Q=setTimeout(function(){O.find(".cropBox").addClass("off")},10)}).click(function(a){a.preventDefault()}).show();A.find(".mm-add-text").click(k.addTextAuto);
A.find(".mm-all-caps").click(function(){ba=!ba;for(var a=0;a<d.length;a++)"text"==d[a].type&&d[a].setText()});A.find(".mm-reset").click(k.reset);A.find(".mm-toggle-drag").change(function(){C($(this).prop("checked"))});A.find(".gen-no-watermark").change(h);A.find(".mm-output-original-resolution").click(function(){if(k.hasDrawing()&&!confirm("Changing this option will remove drawings. Are you sure you wish to continue?"))return!1;va=$(this).prop("checked");var a=x();k.setCanvasWidth(va?a.w:F(a.w,a.h));
h()});var D=ra.width();700>D&&C(!1);$("#mm-show-upload").click(z);var l=$("#mm-upload-public");l.click(function(){$("#mm-upload-name-wrap").toggle(l.prop("checked"))});$("#mm-upload").submit(function(){if(!$("#mm-upload-file").val())return MSG("No file selected","red"),!1;if(!l.prop("checked"))return B(),!1});$("form").keydown(function(a){if(13==a.which)return!1});$("#genSubmit").attr("checked",!1);A.find(".mm-toggle-opts").click(function(){var a=A.find(".mm-opts"),b=$(this);"none"===a.css("display")?
(a.slideDown(200),b.text("Hide Options \u25b2")):(a.slideUp(200),b.text("More Options \u25bc"))});ra.resize(debounce(function(){var a=ra.width();a!==D&&(D=a,k.setWidth(Math.min(x().w,qa.width())))}))};k.initPopMemes=function(){$("#memetab").click(ia);$("#mytab").click(ta);ia()};k.addText=p;k.preview=h};g.ColorPicker=ja;g.generate=V;var ea=!1;g.preloadShareScript=da;g.imgDonePopup=aa;g.imgDone=ca;memeInit=function(){$(".mm-generate").click(function(){var f=GET().stream;if(f)if(!I.user.id)showLogin(),
MSG("You must be logged in to post to a stream!");else{if(!mm.isEmpty()||confirm("Your meme is empty. Are you sure you want to post an empty meme?"))loading("Generating Meme..."),V(function(){g.location="/m/"+f},!1,!1,f)}else V(sa,!1,!0)});$("#shareGen").click(function(){$(this).select()});$(".draw").click(function(){_gaq.push(["_trackEvent","draw panel","draw",mm.currentMeme().name])});$(".mm-add-img").click(function(){_gaq.push(["_trackEvent","draw panel","add image",mm.currentMeme().name])});$(".add-scumbag").click(function(){_gaq.push(["_trackEvent",
"draw panel","add scumbag",mm.currentMeme().name])});$(".mm-rotate").click(function(){_gaq.push(["_trackEvent","draw panel","rotate",mm.currentMeme().name])});Z.on("click",".mm-set-positions",function(){mm.ajaxSetPositions()})};showGenerator=function(f){I.user.id?1E3>I.user.points?error_dialog("You must earn 1,000 points to use meme comments!"):f.data("meme-iid")?MSG("You already have a meme attached to this comment!","red"):(getMemes(),Z.off("click",".mm-generate").on("click",".mm-generate",function(){mm.isEmpty()?
alert("Your meme is empty! Add something to it or click Cancel"):(loading("Generating Meme..."),V(function(c){f.data("meme-iid",c.iid).addClass("has-pending-img").prepend('<img class="c-pending-img" src="//i.imgflip.com/'+c.iid.toString(36)+'.jpg"/>');loading(!1);BOX.hide()},!0))}).off("click",".mm-cancel").on("click",".mm-cancel",function(){BOX.hide()})):showLogin()};var ia=g.requestAnimationFrame||g.mozRequestAnimationFrame||g.webkitRequestAnimationFrame||g.msRequestAnimationFrame;g.lzs=function(f){var c=
function(){var c=Y.createElement("link");c.rel="stylesheet";c.href=f;var g=Y.getElementsByTagName("head")[0];g.parentNode.insertBefore(c,g)};ia?ia(c):g.addEventListener?g.addEventListener("load",c):c()};getMemes=function(){loading("Materializing Meme Generator...");$.ajax({dataType:"json",url:"/ajax_get_meme_list",success:function(f){loading(!1);f.error?error_dialog(f.error):(BOX.show({html:f.html,bg:"transparent",noMaskClick:!0}),mm=new MemeMaker(f.memes,{numTexts:2}),mm.init(),mm.initPopMemes(),
mm.select(0))}})}})(window,document,$(window),$(document));
